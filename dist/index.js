"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),axios=_interopDefault(require("axios"));function __async(e){return new Promise(function(t,r){function s(n,o){try{var u=e[o?"throw":"next"](n)}catch(e){return void r(e)}u.done?t(u.value):Promise.resolve(u.value).then(s,a)}function a(e){s(e,1)}s()})}var getResponse=function(e){return e&&e.data&&e.data.response},getCategoryCount=function(e,t){return __async(function(){var r,s,a,n;return tslib_1.__generator(this,function(o){switch(o.label){case 0:r=0,o.label=1;case 1:return o.trys.push([1,3,,4]),s=tslib_1.__assign({},e.parameters,{start:0,rows:1,fields:"alt_img","p-id":'categoryPathId:"'+e.categoryPathL2+">"+t+'"'}),[4,axios.get(e.unbxdBase+"/category",{headers:e.headers,params:s})];case 2:return a=o.sent(),r=getResponse(a)&&getResponse(a).numberOfProducts||0,[3,4];case 3:return n=o.sent(),[2,Promise.reject(n)];case 4:return[2,Promise.resolve(r)]}})}())},fetchL3Categories=function(e){return new Promise(function(t,r){return __async(function(){var s,a,n,o,u,c,i,l,f,p,g,_,d,h,b,y,m,v;return tslib_1.__generator(this,function(x){switch(x.label){case 0:x.trys.push([0,7,,8]),a=e.parameters,n=a.start,o=a.rows,u=n+o,c=0,i=null,l=!1,f=0,p=0,g=o,_=0,d=e.categoryIdsL3,x.label=1;case 1:return _<d.length?(h=d[_],[4,getCategoryCount(e,h)]):[3,6];case 2:return(b=x.sent())+c>n?(f=0,l?p=b<g?b:g:(c=b-(p=b-(f=b-(b+c-n))<g?b-f:g)-f,l=!0),[4,axios.get(e.unbxdBase+"/category",{headers:e.headers,params:tslib_1.__assign({},e.parameters,{start:f,rows:p})})]):[3,4];case 3:y=x.sent(),i?(m=getResponse(i),(s=m.products).push.apply(s,y.data.response.products)):i=y,g-=p,x.label=4;case 4:if((c+=b)>=u)return[3,6];x.label=5;case 5:return _++,[3,1];case 6:return t(i),[3,8];case 7:return v=x.sent(),r(v),[3,8];case 8:return[2]}})}())})};exports.default=fetchL3Categories,exports.fetchL3Categories=fetchL3Categories;
